<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Java学习笔记(第十二天) | 虾米日记</title>
  <link rel = 'canonical' href = 'https://wjinlei.github.io/posts/exp-java-day12/'>
  <meta name="description" content="对酒当歌，人生几何，譬如朝露，去日苦多">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Java学习笔记(第十二天)" />
<meta property="og:description" content="Thread  线程可以提高程序的执行效率 Java中只有这么一种东西代表线程(Thread) start方法才能并发执行 方法栈是线程私有的(局部变量) 静态变量/类变量是被所有线程共享的  多线程的适用场景  对于IO密集型场景及其有用  网络IO 文件IO   对于CPU密集型稍有折扣(说白了就是不太适用)  因为我们多线程的目的本来就是想不让CPU闲着，闲着CPU已经在密集运算了，因此提升空间不大   性能提升的上线  单核CPU达到100%    开启线程的简单方法 public class Main { public static void main(String[] args) { new Thread(new Runnable() { @Override public void run() { System.out.println(&#34;Thread is run...&#34;); } }).start(); System.out.println(&#34;Main is run...&#34;); } } run &amp; start public class Main { public static void main(String[] args) { new Thread(new Runnable() { @Override public void run() { System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wjinlei.github.io/posts/exp-java-day12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-08T15:07:49+08:00" />
<meta property="article:modified_time" content="2021-11-08T15:07:49+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java学习笔记(第十二天)"/>
<meta name="twitter:description" content="Thread  线程可以提高程序的执行效率 Java中只有这么一种东西代表线程(Thread) start方法才能并发执行 方法栈是线程私有的(局部变量) 静态变量/类变量是被所有线程共享的  多线程的适用场景  对于IO密集型场景及其有用  网络IO 文件IO   对于CPU密集型稍有折扣(说白了就是不太适用)  因为我们多线程的目的本来就是想不让CPU闲着，闲着CPU已经在密集运算了，因此提升空间不大   性能提升的上线  单核CPU达到100%    开启线程的简单方法 public class Main { public static void main(String[] args) { new Thread(new Runnable() { @Override public void run() { System.out.println(&#34;Thread is run...&#34;); } }).start(); System.out.println(&#34;Main is run...&#34;); } } run &amp; start public class Main { public static void main(String[] args) { new Thread(new Runnable() { @Override public void run() { System."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://wjinlei.github.io/css/styles.4c2b9aa1d874d6766f554b2d404e8fd62ab4761f51ee9b3f358d12e81e7fa43a1b4378db995bc1926bbe5ed98c060be5e7bd4f2470504cf94f22b4b3a74e62b6.css" integrity="sha512-TCuaodh01nZvVUstQE6P1iq0dh9R7ps/NY0S6B5/pDobQ3jbmVvBkmu&#43;XtmMBgvl571PJHBQTPlPIrSzp05itg=="> 

  
   <link rel="stylesheet" href="https://wjinlei.github.io/css/custom.css"> 
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://wjinlei.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://wjinlei.github.io/posts/exp-java-day11/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://wjinlei.github.io/posts/exp-java-day13/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&text=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&is_video=false&description=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29&body=Check out this article: https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&name=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29&description=Thread%20%20%e7%ba%bf%e7%a8%8b%e5%8f%af%e4%bb%a5%e6%8f%90%e9%ab%98%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%89%a7%e8%a1%8c%e6%95%88%e7%8e%87%20Java%e4%b8%ad%e5%8f%aa%e6%9c%89%e8%bf%99%e4%b9%88%e4%b8%80%e7%a7%8d%e4%b8%9c%e8%a5%bf%e4%bb%a3%e8%a1%a8%e7%ba%bf%e7%a8%8b%28Thread%29%20start%e6%96%b9%e6%b3%95%e6%89%8d%e8%83%bd%e5%b9%b6%e5%8f%91%e6%89%a7%e8%a1%8c%20%e6%96%b9%e6%b3%95%e6%a0%88%e6%98%af%e7%ba%bf%e7%a8%8b%e7%a7%81%e6%9c%89%e7%9a%84%28%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f%29%20%e9%9d%99%e6%80%81%e5%8f%98%e9%87%8f%2f%e7%b1%bb%e5%8f%98%e9%87%8f%e6%98%af%e8%a2%ab%e6%89%80%e6%9c%89%e7%ba%bf%e7%a8%8b%e5%85%b1%e4%ba%ab%e7%9a%84%20%20%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af%20%20%e5%af%b9%e4%ba%8eIO%e5%af%86%e9%9b%86%e5%9e%8b%e5%9c%ba%e6%99%af%e5%8f%8a%e5%85%b6%e6%9c%89%e7%94%a8%20%20%e7%bd%91%e7%bb%9cIO%20%e6%96%87%e4%bb%b6IO%20%20%20%e5%af%b9%e4%ba%8eCPU%e5%af%86%e9%9b%86%e5%9e%8b%e7%a8%8d%e6%9c%89%e6%8a%98%e6%89%a3%28%e8%af%b4%e7%99%bd%e4%ba%86%e5%b0%b1%e6%98%af%e4%b8%8d%e5%a4%aa%e9%80%82%e7%94%a8%29%20%20%e5%9b%a0%e4%b8%ba%e6%88%91%e4%bb%ac%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%9b%ae%e7%9a%84%e6%9c%ac%e6%9d%a5%e5%b0%b1%e6%98%af%e6%83%b3%e4%b8%8d%e8%ae%a9CPU%e9%97%b2%e7%9d%80%ef%bc%8c%e9%97%b2%e7%9d%80CPU%e5%b7%b2%e7%bb%8f%e5%9c%a8%e5%af%86%e9%9b%86%e8%bf%90%e7%ae%97%e4%ba%86%ef%bc%8c%e5%9b%a0%e6%ad%a4%e6%8f%90%e5%8d%87%e7%a9%ba%e9%97%b4%e4%b8%8d%e5%a4%a7%20%20%20%e6%80%a7%e8%83%bd%e6%8f%90%e5%8d%87%e7%9a%84%e4%b8%8a%e7%ba%bf%20%20%e5%8d%95%e6%a0%b8CPU%e8%be%be%e5%88%b0100%25%20%20%20%20%e5%bc%80%e5%90%af%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%ae%80%e5%8d%95%e6%96%b9%e6%b3%95%20public%20class%20Main%20%7b%20public%20static%20void%20main%28String%5b%5d%20args%29%20%7b%20new%20Thread%28new%20Runnable%28%29%20%7b%20%40Override%20public%20void%20run%28%29%20%7b%20System.out.println%28%26%2334%3bThread%20is%20run...%26%2334%3b%29%3b%20%7d%20%7d%29.start%28%29%3b%20System.out.println%28%26%2334%3bMain%20is%20run...%26%2334%3b%29%3b%20%7d%20%7d%20run%20%26amp%3b%20start%20public%20class%20Main%20%7b%20public%20static%20void%20main%28String%5b%5d%20args%29%20%7b%20new%20Thread%28new%20Runnable%28%29%20%7b%20%40Override%20public%20void%20run%28%29%20%7b%20System." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&t=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Java学习笔记(第十二天)
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-11-08 15:07:49 &#43;0800 CST" itemprop="datePublished">2021-11-08</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          17 minute read
        </div>
        
        
        
      </div>
    </header>

  
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#thread">Thread</a>
      <ul>
        <li><a href="#多线程的适用场景">多线程的适用场景</a></li>
        <li><a href="#开启线程的简单方法">开启线程的简单方法</a></li>
        <li><a href="#run--start">run &amp; start</a></li>
        <li><a href="#多线程问题的来源数据共享">多线程问题的来源(数据共享)</a>
          <ul>
            <li><a href="#例子1">例子1</a></li>
            <li><a href="#例子2-hashmap不是线程安全的">例子2 HashMap不是线程安全的</a></li>
            <li><a href="#例子3-死锁问题">例子3 死锁问题</a></li>
            <li><a href="#如何排查死锁问题">如何排查死锁问题</a></li>
            <li><a href="#预防死锁产生的原则">预防死锁产生的原则</a></li>
          </ul>
        </li>
        <li><a href="#如何写出线程安全的代码">如何写出线程安全的代码</a>
          <ul>
            <li><a href="#synchronized-代码块">synchronized 代码块</a></li>
            <li><a href="#synchronized-静态方法">synchronized 静态方法</a></li>
            <li><a href="#synchronized-实例方法">synchronized 实例方法</a></li>
          </ul>
        </li>
        <li><a href="#collectionssynchronizedxxx">Collections.synchronizedXXX</a></li>
        <li><a href="#juc包javautilconcurrent">JUC包(java.util.concurrent)</a></li>
        <li><a href="#为什么任何对象都可以当成锁">为什么任何对象都可以当成锁?</a></li>
        <li><a href="#生产者消费者模型的多种实现方法">生产者消费者模型的多种实现方法</a>
          <ul>
            <li><a href="#waitnotify">wait/notify</a></li>
            <li><a href="#lockcondition">Lock/Condition</a></li>
            <li><a href="#blockingqueue">BlockingQueue</a></li>
            <li><a href="#semaphore">Semaphore</a></li>
            <li><a href="#exchanger">Exchanger</a></li>
          </ul>
        </li>
        <li><a href="#线程池与callablefuture">线程池与Callable/Future</a>
          <ul>
            <li><a href="#executors的简单使用">Executors的简单使用</a></li>
            <li><a href="#线程池实战-word-count">线程池实战 Word Count</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
    <div class="content" itemprop="articleBody">
      <h2 id="thread">Thread</h2>
<ul>
<li>线程可以提高程序的执行效率</li>
<li>Java中只有这么一种东西代表线程(Thread)</li>
<li>start方法才能并发执行</li>
<li>方法栈是线程私有的(局部变量)</li>
<li>静态变量/类变量是被所有线程共享的</li>
</ul>
<h3 id="多线程的适用场景">多线程的适用场景</h3>
<ul>
<li>对于<code>IO</code>密集型场景及其有用
<ul>
<li>网络<code>IO</code></li>
<li>文件<code>IO</code></li>
</ul>
</li>
<li>对于<code>CPU</code>密集型稍有折扣(说白了就是不太适用)
<ul>
<li>因为我们多线程的目的本来就是想不让<code>CPU</code>闲着，闲着CPU已经在密集运算了，因此提升空间不大</li>
</ul>
</li>
<li>性能提升的上线
<ul>
<li>单核<code>CPU</code>达到<code>100%</code></li>
</ul>
</li>
</ul>
<h3 id="开启线程的简单方法">开启线程的简单方法</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Runnable<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Thread is run...&#34;</span><span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Main is run...&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="run--start">run &amp; start</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Runnable<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentThread</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; is run...&#34;</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>5000<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}).</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// run 方法会等待当前线程执行结束后才会执行下面的操作
</span><span style="color:#998;font-style:italic"></span>
        <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Runnable<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentThread</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; is run...&#34;</span><span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// start方法才能并发执行
</span><span style="color:#998;font-style:italic"></span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Main is run...&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="多线程问题的来源数据共享">多线程问题的来源(数据共享)</h3>
<ul>
<li>线程难的本质原因是：你要看着同一份代码，想象不同的人在疯狂以乱序执行它</li>
</ul>
<h4 id="例子1">例子1</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// 这也是一种简化写法,叫做方法引用,貌似是Java8 + 引入的特性
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">        i = 8
</span><span style="color:#998;font-style:italic">        i = 8
</span><span style="color:#998;font-style:italic">        i = 8
</span><span style="color:#998;font-style:italic">        i = 8
</span><span style="color:#998;font-style:italic">        i = 11
</span><span style="color:#998;font-style:italic">        i = 21
</span><span style="color:#998;font-style:italic">        i = 21
</span><span style="color:#998;font-style:italic">        i = 21
</span><span style="color:#998;font-style:italic">        ...
</span><span style="color:#998;font-style:italic">        从上面可以看出，有些数被+了多次，并不是按照我们想象的每次给i+1，这是为什么呢?
</span><span style="color:#998;font-style:italic">        那是因为i++不是原子操作，假如现在i=0，多个线程同时获得了执行权，这时候他们拿
</span><span style="color:#998;font-style:italic">        到的i的值都是0，因此才发生了上面的情况，某个值被打印了多次
</span><span style="color:#998;font-style:italic">        */</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        i<span style="color:#000;font-weight:bold">++;</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="例子2-hashmap不是线程安全的">例子2 HashMap不是线程安全的</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> Map<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> hashMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>putIfAbsent<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">        Put 0
</span><span style="color:#998;font-style:italic">        Put 0
</span><span style="color:#998;font-style:italic">        Put 1
</span><span style="color:#998;font-style:italic">        Put 6
</span><span style="color:#998;font-style:italic">        Put 5
</span><span style="color:#998;font-style:italic">        Put 9
</span><span style="color:#998;font-style:italic">        Put 8
</span><span style="color:#998;font-style:italic">        Put 3
</span><span style="color:#998;font-style:italic">        Put 4
</span><span style="color:#998;font-style:italic">        Put 2
</span><span style="color:#998;font-style:italic">        Put 7
</span><span style="color:#998;font-style:italic">        
</span><span style="color:#998;font-style:italic">        可以看到，0被添加了多次，这是为什么呢?，请看下面截图
</span><span style="color:#998;font-style:italic">        */</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 生成一个1到10的随机数,看看map中是否存在这个数，如果不存在则添加进去
</span><span style="color:#998;font-style:italic">     * 我们的期望是每个数只可能添加1次
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">putIfAbsent</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#458;font-weight:bold">int</span> rNumber <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">(</span>10<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>hashMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">containsKey</span><span style="color:#000;font-weight:bold">(</span>rNumber<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
            hashMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>rNumber<span style="color:#000;font-weight:bold">,</span> rNumber<span style="color:#000;font-weight:bold">);</span>
            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Put &#34;</span> <span style="color:#000;font-weight:bold">+</span> rNumber<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><blockquote>
<p>说白了，某个线程获得了执行权，此时它判断map中没有0，于是它准备向map中添加0，但好巧不巧<br>
CPU此时将执行权给了另一个线程，此时它也判断map中没有0，于是它向map中添加了一个0，等到<br>
之前的线程获得了执行权的时候，它继续之前没有完成的操作，向map中添加了0，因此0被向map中<br>
添加了两次，这就是这个问题的原因</p>
</blockquote>
<p><img src="/image/exp-java-day12/thread-safe-02.png" alt="thread-safe"></p>
<h4 id="例子3-死锁问题">例子3 死锁问题</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">// 一般来说new Object都是用来当成锁用的
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> Object lock1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// Java中任何对象都可以当成锁
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> Object lock2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// Java中任何对象都可以当成锁
</span><span style="color:#998;font-style:italic"></span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">new</span> Thread1<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">new</span> Thread2<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">        运行这个程序就被卡主了，这是为什么? 请看下面截图
</span><span style="color:#998;font-style:italic">         */</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 创建线程的第二种方式，继承Thread类，重写run方法
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Thread1</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">             synchronized 语句表示同步，说白了就是获取锁
</span><span style="color:#998;font-style:italic">             只有获取到锁的线程才能执行里面的代码
</span><span style="color:#998;font-style:italic">             */</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>500<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#998;font-style:italic">// 获取锁2
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 创建线程的第二种方式，继承Thread类，重写run方法
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Thread2</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>100<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><blockquote>
<p>线程1，先拿到了锁1，然后休眠500毫秒，线程2，先拿到锁2，然后休眠100毫秒，线程2先醒过来，此时它想要获得锁1<br>
而锁1正被线程1拿到，因此它只能进入等待，此时线程1醒来，它想要获得锁2，但锁2此时正被线程2拿着，于是它也只<br>
进入等待，此时，两个线程都等待在那了，因此进入了所谓的死锁状态</p>
</blockquote>
<p><img src="/image/exp-java-day12/thread-safe-03.png" alt="thread-safe"></p>
<h4 id="如何排查死锁问题">如何排查死锁问题</h4>
<ol>
<li>先用<code>jps</code>查找到发生死锁的<code>进程id</code></li>
<li>再用<code>jstack</code>查看该进程的堆栈</li>
</ol>
<h4 id="预防死锁产生的原则">预防死锁产生的原则</h4>
<ul>
<li>所有线程都按照相同的顺序获得资源锁</li>
</ul>
<blockquote>
<p>上面的代码之所以产生死锁问题就是，线程1先获得锁1，再获得锁2，而线程2先获得锁2，再获得锁1</p>
</blockquote>
<h3 id="如何写出线程安全的代码">如何写出线程安全的代码</h3>
<ul>
<li>利用<code>synchronized</code>解决<code>例子1</code>中的问题</li>
</ul>
<h4 id="synchronized-代码块">synchronized 代码块</h4>
<ul>
<li>synchronized 锁住的是指定的对象</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> Object lock <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">();</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            i <span style="color:#000;font-weight:bold">+=</span> 1<span style="color:#000;font-weight:bold">;</span>
            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="synchronized-静态方法">synchronized 静态方法</h4>
<ul>
<li>synchronized 静态方法锁住的是Class对象</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        i <span style="color:#000;font-weight:bold">+=</span> 1<span style="color:#000;font-weight:bold">;</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="synchronized-实例方法">synchronized 实例方法</h4>
<ul>
<li>synchronized 实例方法锁住的是this</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            Main main <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Main<span style="color:#000;font-weight:bold">();</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        i <span style="color:#000;font-weight:bold">+=</span> 1<span style="color:#000;font-weight:bold">;</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">// 这个方法等价于上面的方法
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
            <span style="color:#000;font-weight:bold">}</span>

            i <span style="color:#000;font-weight:bold">+=</span> 1<span style="color:#000;font-weight:bold">;</span>
            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="collectionssynchronizedxxx">Collections.synchronizedXXX</h3>
<p>它可以将集合转换成线程安全的</p>
<ul>
<li>ArrayList</li>
<li>HashSet</li>
<li>TreeSet</li>
<li>HashMap</li>
<li>LinkedHashMap</li>
<li>&hellip;.</li>
</ul>
<h3 id="juc包javautilconcurrent">JUC包(java.util.concurrent)</h3>
<ul>
<li>ConcurrentHashMap</li>
<li>AtomicBoolean</li>
<li>AtomicLong</li>
<li>AtomicInteger</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> AtomicInteger i <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> AtomicInteger<span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAndGet</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><ul>
<li>ReentrantLock</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> ReentrantLock reentrantLock <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ReentrantLock<span style="color:#000;font-weight:bold">();</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> j <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> j <span style="color:#000;font-weight:bold">&lt;</span> 1000<span style="color:#000;font-weight:bold">;</span> j<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">new</span> Thread<span style="color:#000;font-weight:bold">(</span>Main<span style="color:#000;font-weight:bold">::</span>modifySharedVariable<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">modifySharedVariable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">}</span>

        reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lock</span><span style="color:#000;font-weight:bold">();</span>
        i <span style="color:#000;font-weight:bold">+=</span> 1<span style="color:#000;font-weight:bold">;</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;i = &#34;</span> <span style="color:#000;font-weight:bold">+</span> i<span style="color:#000;font-weight:bold">);</span>
        reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unlock</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="为什么任何对象都可以当成锁">为什么任何对象都可以当成锁?</h3>
<ul>
<li>wait</li>
</ul>
<blockquote>
<p>当前线程将进入等待，并释放锁，直到另一个线程调用notify或notifyAll方法</p>
</blockquote>
<ul>
<li>notify</li>
</ul>
<blockquote>
<p>唤醒等待中的线程，如果有多个线程同时在等待，那么将会随机挑选一个唤醒</p>
</blockquote>
<ul>
<li>notifyAll</li>
</ul>
<blockquote>
<p>唤醒所有等待中的线程，唤醒后，它们将重新竞争锁，这个竞争是没有特权的，<br>
和平常一样，谁运气好，谁就能获得锁，没能获得锁的线程，将重新陷入等待</p>
</blockquote>
<h3 id="生产者消费者模型的多种实现方法">生产者消费者模型的多种实现方法</h3>
<h4 id="waitnotify">wait/notify</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Optional</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Random</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProducerConsumer1</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        Container container <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Container<span style="color:#000;font-weight:bold">();</span>
        Object o <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">();</span>
        Producer producer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Producer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> o<span style="color:#000;font-weight:bold">);</span>
        Consumer consumer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Consumer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> o<span style="color:#000;font-weight:bold">);</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        consumer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Object lock<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Producer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> Object lock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lock</span> <span style="color:#000;font-weight:bold">=</span> lock<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                            lock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">wait</span><span style="color:#000;font-weight:bold">();</span>
                        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                        <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">();</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Producing &#34;</span> <span style="color:#000;font-weight:bold">+</span> r<span style="color:#000;font-weight:bold">);</span>
                    container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">));</span>
                    lock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">notify</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Consumer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Object lock<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Consumer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> Object lock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lock</span> <span style="color:#000;font-weight:bold">=</span> lock<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">synchronized</span> <span style="color:#000;font-weight:bold">(</span>lock<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                            lock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">wait</span><span style="color:#000;font-weight:bold">();</span>
                        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                        <span style="color:#000;font-weight:bold">}</span>
                    <span style="color:#000;font-weight:bold">}</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Consuming &#34;</span> <span style="color:#000;font-weight:bold">+</span> container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
                    container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">());</span>
                    lock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">notify</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Container</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">public</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getValue</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">value</span> <span style="color:#000;font-weight:bold">=</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">private</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="lockcondition">Lock/Condition</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Optional</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Random</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.locks.Condition</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.locks.ReentrantLock</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProducerConsumer2</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        Container container <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Container<span style="color:#000;font-weight:bold">();</span>
        ReentrantLock reentrantLock <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ReentrantLock<span style="color:#000;font-weight:bold">();</span>
        Condition isProduce <span style="color:#000;font-weight:bold">=</span> reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newCondition</span><span style="color:#000;font-weight:bold">();</span>
        Condition isConsume <span style="color:#000;font-weight:bold">=</span> reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newCondition</span><span style="color:#000;font-weight:bold">();</span>

        Producer producer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Producer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> reentrantLock<span style="color:#000;font-weight:bold">,</span> isProduce<span style="color:#000;font-weight:bold">,</span> isConsume<span style="color:#000;font-weight:bold">);</span>
        Consumer consumer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Consumer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> reentrantLock<span style="color:#000;font-weight:bold">,</span> isProduce<span style="color:#000;font-weight:bold">,</span> isConsume<span style="color:#000;font-weight:bold">);</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        consumer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> ReentrantLock reentrantLock<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Condition isProduce<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Condition isConsume<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Producer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> ReentrantLock reentrantLock<span style="color:#000;font-weight:bold">,</span> Condition isProduce<span style="color:#000;font-weight:bold">,</span> Condition isConsume<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">reentrantLock</span> <span style="color:#000;font-weight:bold">=</span> reentrantLock<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isProduce</span> <span style="color:#000;font-weight:bold">=</span> isProduce<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isConsume</span> <span style="color:#000;font-weight:bold">=</span> isConsume<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lock</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                        isProduce<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">await</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">();</span>
                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Producing &#34;</span> <span style="color:#000;font-weight:bold">+</span> r<span style="color:#000;font-weight:bold">);</span>
                container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">));</span>
                isConsume<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">signal</span><span style="color:#000;font-weight:bold">();</span>
                reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unlock</span><span style="color:#000;font-weight:bold">();</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Consumer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> ReentrantLock reentrantLock<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Condition isProduce<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Condition isConsume<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Consumer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> ReentrantLock reentrantLock<span style="color:#000;font-weight:bold">,</span> Condition isProduce<span style="color:#000;font-weight:bold">,</span> Condition isConsume<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">reentrantLock</span> <span style="color:#000;font-weight:bold">=</span> reentrantLock<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isProduce</span> <span style="color:#000;font-weight:bold">=</span> isProduce<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isConsume</span> <span style="color:#000;font-weight:bold">=</span> isConsume<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lock</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                        isConsume<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">await</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>

                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Consuming &#34;</span> <span style="color:#000;font-weight:bold">+</span> container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
                container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">());</span>
                isProduce<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">signal</span><span style="color:#000;font-weight:bold">();</span>
                reentrantLock<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unlock</span><span style="color:#000;font-weight:bold">();</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Container</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">public</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getValue</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">value</span> <span style="color:#000;font-weight:bold">=</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">private</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="blockingqueue">BlockingQueue</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Random</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.BlockingQueue</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.LinkedBlockingQueue</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProducerConsumer3</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> blockingQueue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> LinkedBlockingQueue<span style="color:#000;font-weight:bold">&lt;&gt;(</span>1<span style="color:#000;font-weight:bold">);</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> single <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> LinkedBlockingQueue<span style="color:#000;font-weight:bold">&lt;&gt;(</span>1<span style="color:#000;font-weight:bold">);</span>

        Producer producer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Producer<span style="color:#000;font-weight:bold">(</span>blockingQueue<span style="color:#000;font-weight:bold">,</span> single<span style="color:#000;font-weight:bold">);</span>
        Consumer consumer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Consumer<span style="color:#000;font-weight:bold">(</span>blockingQueue<span style="color:#000;font-weight:bold">,</span> single<span style="color:#000;font-weight:bold">);</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        consumer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container<span style="color:#000;font-weight:bold">;</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Producer</span><span style="color:#000;font-weight:bold">(</span>BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container<span style="color:#000;font-weight:bold">,</span> BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">single</span> <span style="color:#000;font-weight:bold">=</span> single<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">();</span>
                System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Producing &#34;</span> <span style="color:#000;font-weight:bold">+</span> r<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">);</span>
                    single<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">take</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// 等待Consumer通知我再生产
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Consumer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container<span style="color:#000;font-weight:bold">;</span>
        BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Consumer</span><span style="color:#000;font-weight:bold">(</span>BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container<span style="color:#000;font-weight:bold">,</span> BlockingQueue<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">single</span> <span style="color:#000;font-weight:bold">=</span> single<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Consuming &#34;</span> <span style="color:#000;font-weight:bold">+</span> container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">take</span><span style="color:#000;font-weight:bold">());</span>
                    single<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">);</span> <span style="color:#998;font-style:italic">// 通知Producer再次生产
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="semaphore">Semaphore</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProducerConsumer4</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        Container container <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Container<span style="color:#000;font-weight:bold">();</span>
        Semaphore semaphore <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Semaphore<span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#998;font-style:italic">// 创建公平锁，当两个线程同时具备竞争锁的条件时，一人一次
</span><span style="color:#998;font-style:italic"></span>        Producer producer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Producer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> semaphore<span style="color:#000;font-weight:bold">);</span>
        Consumer consumer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Consumer<span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">,</span> semaphore<span style="color:#000;font-weight:bold">);</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        consumer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Semaphore semaphore<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Producer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> Semaphore semaphore<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">semaphore</span> <span style="color:#000;font-weight:bold">=</span> semaphore<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    semaphore<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">acquire</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">();</span>
                        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Producing &#34;</span> <span style="color:#000;font-weight:bold">+</span> r<span style="color:#000;font-weight:bold">);</span>
                        container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">));</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
                    semaphore<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">release</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Consumer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Container container<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">final</span> Semaphore semaphore<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Consumer</span><span style="color:#000;font-weight:bold">(</span>Container container<span style="color:#000;font-weight:bold">,</span> Semaphore semaphore<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">container</span> <span style="color:#000;font-weight:bold">=</span> container<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">semaphore</span> <span style="color:#000;font-weight:bold">=</span> semaphore<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    semaphore<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">acquire</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Consuming &#34;</span> <span style="color:#000;font-weight:bold">+</span> container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
                        container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">());</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
                    semaphore<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">release</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Container</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">public</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getValue</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setValue</span><span style="color:#000;font-weight:bold">(</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">value</span> <span style="color:#000;font-weight:bold">=</span> value<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">private</span> Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> value <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="exchanger">Exchanger</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProducerConsumer5</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> exchanger <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Exchanger<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">&gt;</span> single <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Exchanger<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
        Producer producer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Producer<span style="color:#000;font-weight:bold">(</span>exchanger<span style="color:#000;font-weight:bold">,</span> single<span style="color:#000;font-weight:bold">);</span>
        Consumer consumer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Consumer<span style="color:#000;font-weight:bold">(</span>exchanger<span style="color:#000;font-weight:bold">,</span> single<span style="color:#000;font-weight:bold">);</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>
        consumer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">start</span><span style="color:#000;font-weight:bold">();</span>

        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
        producer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">join</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Producer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> exchanger<span style="color:#000;font-weight:bold">;</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Producer</span><span style="color:#000;font-weight:bold">(</span>Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> exchanger<span style="color:#000;font-weight:bold">,</span> Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchanger</span> <span style="color:#000;font-weight:bold">=</span> exchanger<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">single</span> <span style="color:#000;font-weight:bold">=</span> single<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Random<span style="color:#000;font-weight:bold">().</span><span style="color:#008080">nextInt</span><span style="color:#000;font-weight:bold">();</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Producing &#34;</span> <span style="color:#000;font-weight:bold">+</span> r<span style="color:#000;font-weight:bold">);</span>
                    container <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">of</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    container <span style="color:#000;font-weight:bold">=</span> exchanger<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchange</span><span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">);</span> <span style="color:#998;font-style:italic">// 交换容器，如果对方没有到达交换点则阻塞
</span><span style="color:#998;font-style:italic"></span>                    single<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Consumer</span> <span style="color:#000;font-weight:bold">extends</span> Thread <span style="color:#000;font-weight:bold">{</span>
        Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> container <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> exchanger<span style="color:#000;font-weight:bold">;</span>
        Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Consumer</span><span style="color:#000;font-weight:bold">(</span>Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Optional<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> exchanger<span style="color:#000;font-weight:bold">,</span> Exchanger<span style="color:#000;font-weight:bold">&lt;</span>Boolean<span style="color:#000;font-weight:bold">&gt;</span> single<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchanger</span> <span style="color:#000;font-weight:bold">=</span> exchanger<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">single</span> <span style="color:#000;font-weight:bold">=</span> single<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">run</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> 10<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                    container <span style="color:#000;font-weight:bold">=</span> exchanger<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchange</span><span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">);</span> <span style="color:#998;font-style:italic">// 交换容器，如果对方没有到达交换点则阻塞
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isPresent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
                    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Consuming &#34;</span> <span style="color:#000;font-weight:bold">+</span> container<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
                    container <span style="color:#000;font-weight:bold">=</span> Optional<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">empty</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
                        single<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exchange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
                    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="线程池与callablefuture">线程池与Callable/Future</h3>
<ul>
<li>线程池是预先定义好的若干个线程</li>
<li>Java中线程池的实现是通过<code>Executors</code></li>
<li><code>Runable</code>和<code>Callable</code>
<ul>
<li><code>Runable</code> 没有返回值</li>
<li><code>Runable</code> 没有声明抛出的异常(这意味着你要实现它的话，必须把异常吞掉，这是非常不爽的)</li>
</ul>
</li>
</ul>
<h4 id="executors的简单使用">Executors的简单使用</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Main</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> ExecutionException<span style="color:#000;font-weight:bold">,</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>
        ExecutorService threadPool <span style="color:#000;font-weight:bold">=</span> Executors<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newFixedThreadPool</span><span style="color:#000;font-weight:bold">(</span>10<span style="color:#000;font-weight:bold">);</span>

        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">         * return Future 表示一个未来才会有结果的东西
</span><span style="color:#998;font-style:italic">         */</span>
        Future<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;</span> future1 <span style="color:#000;font-weight:bold">=</span> threadPool<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">submit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Callable<span style="color:#000;font-weight:bold">&lt;</span>Integer<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> Integer <span style="color:#900;font-weight:bold">call</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
                Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1000<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">return</span> 0<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">});</span>

        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">         * return Future 表示一个未来才会有结果的东西
</span><span style="color:#998;font-style:italic">         */</span>
        Future<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> future2 <span style="color:#000;font-weight:bold">=</span> threadPool<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">submit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Callable<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">call</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
                Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1000<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;Hello Thread.&#34;</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">});</span>

        <span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">         * return Future 表示一个未来才会有结果的东西
</span><span style="color:#998;font-style:italic">         */</span>
        Future<span style="color:#000;font-weight:bold">&lt;</span>Object<span style="color:#000;font-weight:bold">&gt;</span> future3 <span style="color:#000;font-weight:bold">=</span> threadPool<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">submit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Callable<span style="color:#000;font-weight:bold">&lt;</span>Object<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">call</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
                Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>1000<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> RuntimeException<span style="color:#000;font-weight:bold">();</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">});</span>

        <span style="color:#998;font-style:italic">// 当调用get方法时，如果结果还没有被返回，则会阻塞
</span><span style="color:#998;font-style:italic"></span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>future1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>future2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>future3<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="线程池实战-word-count">线程池实战 Word Count</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.BufferedReader</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.File</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.FileNotFoundException</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.FileReader</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.ArrayList</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.HashMap</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.List</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Map</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.*</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MultiThreadWordCount1</span> <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#998;font-style:italic">/* 
</span><span style="color:#998;font-style:italic">    使用threadNum个线程，并发统计文件中各单词的数量
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">count</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> threadNum<span style="color:#000;font-weight:bold">,</span> List<span style="color:#000;font-weight:bold">&lt;</span>File<span style="color:#000;font-weight:bold">&gt;</span> files<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> FileNotFoundException<span style="color:#000;font-weight:bold">,</span>
            ExecutionException<span style="color:#000;font-weight:bold">,</span> InterruptedException <span style="color:#000;font-weight:bold">{</span>

        ExecutorService threadPool <span style="color:#000;font-weight:bold">=</span> Executors<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newFixedThreadPool</span><span style="color:#000;font-weight:bold">(</span>threadNum<span style="color:#000;font-weight:bold">);</span>
        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> finalResult <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>

        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>File file <span style="color:#000;font-weight:bold">:</span> files<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            BufferedReader bufferedReader <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> BufferedReader<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> FileReader<span style="color:#000;font-weight:bold">(</span>file<span style="color:#000;font-weight:bold">));</span>
            List<span style="color:#000;font-weight:bold">&lt;</span>Future<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> futures <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>

            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span> threadNum<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
                futures<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>threadPool<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">submit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Worker<span style="color:#000;font-weight:bold">(</span>bufferedReader<span style="color:#000;font-weight:bold">)));</span>
            <span style="color:#000;font-weight:bold">}</span>

            Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> eachResult <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Future<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> future <span style="color:#000;font-weight:bold">:</span> futures<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> workResult <span style="color:#000;font-weight:bold">=</span> future<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">();</span>
                meargeWorkerResultToFinalResult<span style="color:#000;font-weight:bold">(</span>workResult<span style="color:#000;font-weight:bold">,</span> eachResult<span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">}</span>
            meargeWorkerResultToFinalResult<span style="color:#000;font-weight:bold">(</span>eachResult<span style="color:#000;font-weight:bold">,</span> finalResult<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> finalResult<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">meargeWorkerResultToFinalResult</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> workResult<span style="color:#000;font-weight:bold">,</span>
                                                        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> finalResult<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Entry</span><span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> entry <span style="color:#000;font-weight:bold">:</span> workResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">entrySet</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#458;font-weight:bold">int</span> count <span style="color:#000;font-weight:bold">=</span> finalResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getOrDefault</span><span style="color:#000;font-weight:bold">(</span>entry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">(),</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">+</span> entry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">();</span>
            finalResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>entry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">(),</span> count<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Worker</span> <span style="color:#000;font-weight:bold">implements</span> Callable<span style="color:#000;font-weight:bold">&lt;</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        BufferedReader bufferedReader<span style="color:#000;font-weight:bold">;</span>

        Worker<span style="color:#000;font-weight:bold">(</span>BufferedReader bufferedReader<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bufferedReader</span> <span style="color:#000;font-weight:bold">=</span> bufferedReader<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">call</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
            String line<span style="color:#000;font-weight:bold">;</span>
            Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Integer<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
            <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">((</span>line <span style="color:#000;font-weight:bold">=</span> bufferedReader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">readLine</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                String<span style="color:#000;font-weight:bold">[]</span> words <span style="color:#000;font-weight:bold">=</span> line<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34; &#34;</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>String word <span style="color:#000;font-weight:bold">:</span> words<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>word<span style="color:#000;font-weight:bold">,</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getOrDefault</span><span style="color:#000;font-weight:bold">(</span>word<span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">+</span> 1<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
    </div>
  </article>

  
  




  <div class="blog-post-comments">
    
      <div id="disquss_thread">
  <script src="https://utteranc.es/client.js"
    repo="Wjinlei/wjinlei.github.io"
    issue-term="pathname"
    label="Wjinlei"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</div>

    
  </div>



  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Writings</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&text=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&is_video=false&description=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29&body=Check out this article: https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&title=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&name=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29&description=Thread%20%20%e7%ba%bf%e7%a8%8b%e5%8f%af%e4%bb%a5%e6%8f%90%e9%ab%98%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%89%a7%e8%a1%8c%e6%95%88%e7%8e%87%20Java%e4%b8%ad%e5%8f%aa%e6%9c%89%e8%bf%99%e4%b9%88%e4%b8%80%e7%a7%8d%e4%b8%9c%e8%a5%bf%e4%bb%a3%e8%a1%a8%e7%ba%bf%e7%a8%8b%28Thread%29%20start%e6%96%b9%e6%b3%95%e6%89%8d%e8%83%bd%e5%b9%b6%e5%8f%91%e6%89%a7%e8%a1%8c%20%e6%96%b9%e6%b3%95%e6%a0%88%e6%98%af%e7%ba%bf%e7%a8%8b%e7%a7%81%e6%9c%89%e7%9a%84%28%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f%29%20%e9%9d%99%e6%80%81%e5%8f%98%e9%87%8f%2f%e7%b1%bb%e5%8f%98%e9%87%8f%e6%98%af%e8%a2%ab%e6%89%80%e6%9c%89%e7%ba%bf%e7%a8%8b%e5%85%b1%e4%ba%ab%e7%9a%84%20%20%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e9%80%82%e7%94%a8%e5%9c%ba%e6%99%af%20%20%e5%af%b9%e4%ba%8eIO%e5%af%86%e9%9b%86%e5%9e%8b%e5%9c%ba%e6%99%af%e5%8f%8a%e5%85%b6%e6%9c%89%e7%94%a8%20%20%e7%bd%91%e7%bb%9cIO%20%e6%96%87%e4%bb%b6IO%20%20%20%e5%af%b9%e4%ba%8eCPU%e5%af%86%e9%9b%86%e5%9e%8b%e7%a8%8d%e6%9c%89%e6%8a%98%e6%89%a3%28%e8%af%b4%e7%99%bd%e4%ba%86%e5%b0%b1%e6%98%af%e4%b8%8d%e5%a4%aa%e9%80%82%e7%94%a8%29%20%20%e5%9b%a0%e4%b8%ba%e6%88%91%e4%bb%ac%e5%a4%9a%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%9b%ae%e7%9a%84%e6%9c%ac%e6%9d%a5%e5%b0%b1%e6%98%af%e6%83%b3%e4%b8%8d%e8%ae%a9CPU%e9%97%b2%e7%9d%80%ef%bc%8c%e9%97%b2%e7%9d%80CPU%e5%b7%b2%e7%bb%8f%e5%9c%a8%e5%af%86%e9%9b%86%e8%bf%90%e7%ae%97%e4%ba%86%ef%bc%8c%e5%9b%a0%e6%ad%a4%e6%8f%90%e5%8d%87%e7%a9%ba%e9%97%b4%e4%b8%8d%e5%a4%a7%20%20%20%e6%80%a7%e8%83%bd%e6%8f%90%e5%8d%87%e7%9a%84%e4%b8%8a%e7%ba%bf%20%20%e5%8d%95%e6%a0%b8CPU%e8%be%be%e5%88%b0100%25%20%20%20%20%e5%bc%80%e5%90%af%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%ae%80%e5%8d%95%e6%96%b9%e6%b3%95%20public%20class%20Main%20%7b%20public%20static%20void%20main%28String%5b%5d%20args%29%20%7b%20new%20Thread%28new%20Runnable%28%29%20%7b%20%40Override%20public%20void%20run%28%29%20%7b%20System.out.println%28%26%2334%3bThread%20is%20run...%26%2334%3b%29%3b%20%7d%20%7d%29.start%28%29%3b%20System.out.println%28%26%2334%3bMain%20is%20run...%26%2334%3b%29%3b%20%7d%20%7d%20run%20%26amp%3b%20start%20public%20class%20Main%20%7b%20public%20static%20void%20main%28String%5b%5d%20args%29%20%7b%20new%20Thread%28new%20Runnable%28%29%20%7b%20%40Override%20public%20void%20run%28%29%20%7b%20System." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwjinlei.github.io%2fposts%2fexp-java-day12%2f&t=Java%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%28%e7%ac%ac%e5%8d%81%e4%ba%8c%e5%a4%a9%29" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  this 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
